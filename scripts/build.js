#!/usr/bin/env node
const path = require("path");
const chalk = require("chalk");
const shelljs = require("shelljs");
const globby = require("globby");
const nodeVersion = require("../node-version");

function run(cmd) {
  return shelljs.exec(cmd, {
    env: Object.assign({}, process.env, {
      PATH: "./node_modules/.bin/:" + process.env.PATH,
    }),
  });
}

const prebuiltNodeVersions = [
  // Got these from https://github.com/nexe/nexe/releases/tag/v3.3.3
  "alpine-x64-10.0.0",
  "alpine-x64-10.1.0",
  "alpine-x64-10.10.0",
  "alpine-x64-10.11.0",
  "alpine-x64-10.12.0",
  "alpine-x64-10.13.0",
  "alpine-x64-10.14.0",
  "alpine-x64-10.14.1",
  "alpine-x64-10.14.2",
  "alpine-x64-10.15.0",
  "alpine-x64-10.15.1",
  "alpine-x64-10.15.2",
  "alpine-x64-10.15.3",
  "alpine-x64-10.16.0",
  "alpine-x64-10.2.0",
  "alpine-x64-10.2.1",
  "alpine-x64-10.3.0",
  "alpine-x64-10.4.0",
  "alpine-x64-10.4.1",
  "alpine-x64-10.5.0",
  "alpine-x64-10.6.0",
  "alpine-x64-10.7.0",
  "alpine-x64-10.8.0",
  "alpine-x64-10.9.0",
  "alpine-x64-12.0.0",
  "alpine-x64-12.1.0",
  "alpine-x64-12.2.0",
  "alpine-x64-12.3.0",
  "alpine-x64-12.3.1",
  "alpine-x64-12.4.0",
  "alpine-x64-12.5.0",
  "alpine-x64-12.6.0",
  "alpine-x64-12.9.0",
  "alpine-x64-12.9.1",
  "alpine-x64-6.16.0",
  "alpine-x64-6.17.0",
  "alpine-x64-6.17.1",
  "alpine-x64-8.0.0",
  "alpine-x64-8.1.0",
  "alpine-x64-8.1.1",
  "alpine-x64-8.1.2",
  "alpine-x64-8.1.3",
  "alpine-x64-8.1.4",
  "alpine-x64-8.10.0",
  "alpine-x64-8.11.0",
  "alpine-x64-8.11.1",
  "alpine-x64-8.11.2",
  "alpine-x64-8.11.3",
  "alpine-x64-8.11.4",
  "alpine-x64-8.12.0",
  "alpine-x64-8.13.0",
  "alpine-x64-8.14.0",
  "alpine-x64-8.14.1",
  "alpine-x64-8.15.0",
  "alpine-x64-8.15.1",
  "alpine-x64-8.16.0",
  "alpine-x64-8.2.0",
  "alpine-x64-8.2.1",
  "alpine-x64-8.3.0",
  "alpine-x64-8.4.0",
  "alpine-x64-8.5.0",
  "alpine-x64-8.6.0",
  "alpine-x64-8.7.0",
  "alpine-x64-8.8.0",
  "alpine-x64-8.8.1",
  "alpine-x64-8.9.0",
  "alpine-x64-8.9.1",
  "alpine-x64-8.9.2",
  "alpine-x64-8.9.3",
  "alpine-x64-8.9.4",
  "alpine-x86-10.0.0",
  "alpine-x86-10.1.0",
  "alpine-x86-10.10.0",
  "alpine-x86-10.11.0",
  "alpine-x86-10.12.0",
  "alpine-x86-10.13.0",
  "alpine-x86-10.14.0",
  "alpine-x86-10.14.1",
  "alpine-x86-10.14.2",
  "alpine-x86-10.15.0",
  "alpine-x86-10.15.1",
  "alpine-x86-10.15.2",
  "alpine-x86-10.15.3",
  "alpine-x86-10.2.0",
  "alpine-x86-10.2.1",
  "alpine-x86-10.3.0",
  "alpine-x86-10.4.0",
  "alpine-x86-10.4.1",
  "alpine-x86-10.5.0",
  "alpine-x86-10.6.0",
  "alpine-x86-10.7.0",
  "alpine-x86-10.8.0",
  "alpine-x86-10.9.0",
  "alpine-x86-12.0.0",
  "alpine-x86-12.1.0",
  "alpine-x86-12.10.0",
  "alpine-x86-12.2.0",
  "alpine-x86-12.3.0",
  "alpine-x86-12.3.1",
  "alpine-x86-12.4.0",
  "alpine-x86-12.5.0",
  "alpine-x86-12.6.0",
  "alpine-x86-12.7.0",
  "alpine-x86-12.8.1",
  "alpine-x86-12.9.0",
  "alpine-x86-12.9.1",
  "alpine-x86-6.15.1",
  "alpine-x86-6.16.0",
  "alpine-x86-6.17.0",
  "alpine-x86-6.17.1",
  "alpine-x86-8.0.0",
  "alpine-x86-8.1.0",
  "alpine-x86-8.1.1",
  "alpine-x86-8.1.2",
  "alpine-x86-8.1.3",
  "alpine-x86-8.1.4",
  "alpine-x86-8.10.0",
  "alpine-x86-8.11.0",
  "alpine-x86-8.11.1",
  "alpine-x86-8.11.2",
  "alpine-x86-8.11.3",
  "alpine-x86-8.11.4",
  "alpine-x86-8.12.0",
  "alpine-x86-8.13.0",
  "alpine-x86-8.14.0",
  "alpine-x86-8.14.1",
  "alpine-x86-8.15.0",
  "alpine-x86-8.15.1",
  "alpine-x86-8.16.0",
  "alpine-x86-8.2.0",
  "alpine-x86-8.2.1",
  "alpine-x86-8.3.0",
  "alpine-x86-8.4.0",
  "alpine-x86-8.5.0",
  "alpine-x86-8.6.0",
  "alpine-x86-8.7.0",
  "alpine-x86-8.8.0",
  "alpine-x86-8.8.1",
  "alpine-x86-8.9.0",
  "alpine-x86-8.9.1",
  "alpine-x86-8.9.2",
  "alpine-x86-8.9.3",
  "alpine-x86-8.9.4",
  "linux-x64-10.0.0",
  "linux-x64-10.1.0",
  "linux-x64-10.10.0",
  "linux-x64-10.11.0",
  "linux-x64-10.12.0",
  "linux-x64-10.13.0",
  "linux-x64-10.14.0",
  "linux-x64-10.14.1",
  "linux-x64-10.14.2",
  "linux-x64-10.15.0",
  "linux-x64-10.15.1",
  "linux-x64-10.15.2",
  "linux-x64-10.15.3",
  "linux-x64-10.16.0",
  "linux-x64-10.16.1",
  "linux-x64-10.16.2",
  "linux-x64-10.16.3",
  "linux-x64-10.17.0",
  "linux-x64-10.18.0",
  "linux-x64-10.18.1",
  "linux-x64-10.19.0",
  "linux-x64-10.2.0",
  "linux-x64-10.2.1",
  "linux-x64-10.20.0",
  "linux-x64-10.20.1",
  "linux-x64-10.3.0",
  "linux-x64-10.4.0",
  "linux-x64-10.4.1",
  "linux-x64-10.5.0",
  "linux-x64-10.6.0",
  "linux-x64-10.7.0",
  "linux-x64-10.8.0",
  "linux-x64-10.9.0",
  "linux-x64-12.0.0",
  "linux-x64-12.1.0",
  "linux-x64-12.10.0",
  "linux-x64-12.11.1",
  "linux-x64-12.12.0",
  "linux-x64-12.13.0",
  "linux-x64-12.13.1",
  "linux-x64-12.14.0",
  "linux-x64-12.14.1",
  "linux-x64-12.15.0",
  "linux-x64-12.16.0",
  "linux-x64-12.16.1",
  "linux-x64-12.16.2",
  "linux-x64-12.2.0",
  "linux-x64-12.3.0",
  "linux-x64-12.3.1",
  "linux-x64-12.4.0",
  "linux-x64-12.5.0",
  "linux-x64-12.6.0",
  "linux-x64-12.7.0",
  "linux-x64-12.8.0",
  "linux-x64-12.8.1",
  "linux-x64-12.9.0",
  "linux-x64-12.9.1",
  "linux-x64-14.15.2",
  "linux-x64-14.15.3",
  "linux-x64-4.9.1",
  "linux-x64-6.0.0",
  "linux-x64-6.1.0",
  "linux-x64-6.10.0",
  "linux-x64-6.10.1",
  "linux-x64-6.10.2",
  "linux-x64-6.10.3",
  "linux-x64-6.11.0",
  "linux-x64-6.11.1",
  "linux-x64-6.11.2",
  "linux-x64-6.11.3",
  "linux-x64-6.11.4",
  "linux-x64-6.11.5",
  "linux-x64-6.12.0",
  "linux-x64-6.12.1",
  "linux-x64-6.12.2",
  "linux-x64-6.12.3",
  "linux-x64-6.13.0",
  "linux-x64-6.13.1",
  "linux-x64-6.14.0",
  "linux-x64-6.14.1",
  "linux-x64-6.14.2",
  "linux-x64-6.14.3",
  "linux-x64-6.14.4",
  "linux-x64-6.15.0",
  "linux-x64-6.15.1",
  "linux-x64-6.16.0",
  "linux-x64-6.17.0",
  "linux-x64-6.17.1",
  "linux-x64-6.2.0",
  "linux-x64-6.2.1",
  "linux-x64-6.2.2",
  "linux-x64-6.3.0",
  "linux-x64-6.3.1",
  "linux-x64-6.4.0",
  "linux-x64-6.5.0",
  "linux-x64-6.6.0",
  "linux-x64-6.7.0",
  "linux-x64-6.8.0",
  "linux-x64-6.8.1",
  "linux-x64-6.9.0",
  "linux-x64-6.9.1",
  "linux-x64-6.9.2",
  "linux-x64-6.9.3",
  "linux-x64-6.9.4",
  "linux-x64-6.9.5",
  "linux-x64-8.0.0",
  "linux-x64-8.1.0",
  "linux-x64-8.1.1",
  "linux-x64-8.1.2",
  "linux-x64-8.1.3",
  "linux-x64-8.1.4",
  "linux-x64-8.10.0",
  "linux-x64-8.11.0",
  "linux-x64-8.11.1",
  "linux-x64-8.11.2",
  "linux-x64-8.11.3",
  "linux-x64-8.11.4",
  "linux-x64-8.12.0",
  "linux-x64-8.13.0",
  "linux-x64-8.14.0",
  "linux-x64-8.14.1",
  "linux-x64-8.15.0",
  "linux-x64-8.15.1",
  "linux-x64-8.16.0",
  "linux-x64-8.16.1",
  "linux-x64-8.16.2",
  "linux-x64-8.17.0",
  "linux-x64-8.2.0",
  "linux-x64-8.2.1",
  "linux-x64-8.3.0",
  "linux-x64-8.4.0",
  "linux-x64-8.5.0",
  "linux-x64-8.6.0",
  "linux-x64-8.7.0",
  "linux-x64-8.8.0",
  "linux-x64-8.8.1",
  "linux-x64-8.9.0",
  "linux-x64-8.9.1",
  "linux-x64-8.9.2",
  "linux-x64-8.9.3",
  "linux-x64-8.9.4",
  "linux-x86-10.0.0",
  "linux-x86-10.1.0",
  "linux-x86-10.10.0",
  "linux-x86-10.11.0",
  "linux-x86-10.12.0",
  "linux-x86-10.13.0",
  "linux-x86-10.14.0",
  "linux-x86-10.14.1",
  "linux-x86-10.14.2",
  "linux-x86-10.15.0",
  "linux-x86-10.15.1",
  "linux-x86-10.15.2",
  "linux-x86-10.15.3",
  "linux-x86-10.16.0",
  "linux-x86-10.16.1",
  "linux-x86-10.16.2",
  "linux-x86-10.16.3",
  "linux-x86-10.17.0",
  "linux-x86-10.18.0",
  "linux-x86-10.18.1",
  "linux-x86-10.19.0",
  "linux-x86-10.2.0",
  "linux-x86-10.2.1",
  "linux-x86-10.20.0",
  "linux-x86-10.20.1",
  "linux-x86-10.3.0",
  "linux-x86-10.4.0",
  "linux-x86-10.4.1",
  "linux-x86-10.5.0",
  "linux-x86-10.6.0",
  "linux-x86-10.7.0",
  "linux-x86-10.8.0",
  "linux-x86-10.9.0",
  "linux-x86-12.0.0",
  "linux-x86-12.1.0",
  "linux-x86-12.10.0",
  "linux-x86-12.11.1",
  "linux-x86-12.12.0",
  "linux-x86-12.13.0",
  "linux-x86-12.13.1",
  "linux-x86-12.14.0",
  "linux-x86-12.14.1",
  "linux-x86-12.15.0",
  "linux-x86-12.16.0",
  "linux-x86-12.16.1",
  "linux-x86-12.16.2",
  "linux-x86-12.2.0",
  "linux-x86-12.3.0",
  "linux-x86-12.3.1",
  "linux-x86-12.4.0",
  "linux-x86-12.5.0",
  "linux-x86-12.6.0",
  "linux-x86-12.7.0",
  "linux-x86-12.8.0",
  "linux-x86-12.8.1",
  "linux-x86-12.9.0",
  "linux-x86-12.9.1",
  "linux-x86-14.15.2",
  "linux-x86-14.15.3",
  "linux-x86-4.9.1",
  "linux-x86-6.0.0",
  "linux-x86-6.1.0",
  "linux-x86-6.10.0",
  "linux-x86-6.10.1",
  "linux-x86-6.10.2",
  "linux-x86-6.10.3",
  "linux-x86-6.11.0",
  "linux-x86-6.11.1",
  "linux-x86-6.11.2",
  "linux-x86-6.11.3",
  "linux-x86-6.11.4",
  "linux-x86-6.11.5",
  "linux-x86-6.12.0",
  "linux-x86-6.12.1",
  "linux-x86-6.12.2",
  "linux-x86-6.12.3",
  "linux-x86-6.13.0",
  "linux-x86-6.13.1",
  "linux-x86-6.14.0",
  "linux-x86-6.14.1",
  "linux-x86-6.14.2",
  "linux-x86-6.14.3",
  "linux-x86-6.14.4",
  "linux-x86-6.15.0",
  "linux-x86-6.15.1",
  "linux-x86-6.16.0",
  "linux-x86-6.17.0",
  "linux-x86-6.17.1",
  "linux-x86-6.2.0",
  "linux-x86-6.2.1",
  "linux-x86-6.2.2",
  "linux-x86-6.3.0",
  "linux-x86-6.3.1",
  "linux-x86-6.4.0",
  "linux-x86-6.5.0",
  "linux-x86-6.6.0",
  "linux-x86-6.7.0",
  "linux-x86-6.8.0",
  "linux-x86-6.8.1",
  "linux-x86-6.9.0",
  "linux-x86-6.9.1",
  "linux-x86-6.9.2",
  "linux-x86-6.9.3",
  "linux-x86-6.9.4",
  "linux-x86-6.9.5",
  "linux-x86-8.0.0",
  "linux-x86-8.1.0",
  "linux-x86-8.1.1",
  "linux-x86-8.1.2",
  "linux-x86-8.1.3",
  "linux-x86-8.1.4",
  "linux-x86-8.10.0",
  "linux-x86-8.11.0",
  "linux-x86-8.11.1",
  "linux-x86-8.11.2",
  "linux-x86-8.11.3",
  "linux-x86-8.11.4",
  "linux-x86-8.12.0",
  "linux-x86-8.13.0",
  "linux-x86-8.14.0",
  "linux-x86-8.14.1",
  "linux-x86-8.15.0",
  "linux-x86-8.15.1",
  "linux-x86-8.16.0",
  "linux-x86-8.16.1",
  "linux-x86-8.16.2",
  "linux-x86-8.17.0",
  "linux-x86-8.2.0",
  "linux-x86-8.2.1",
  "linux-x86-8.3.0",
  "linux-x86-8.4.0",
  "linux-x86-8.5.0",
  "linux-x86-8.6.0",
  "linux-x86-8.7.0",
  "linux-x86-8.8.0",
  "linux-x86-8.8.1",
  "linux-x86-8.9.0",
  "linux-x86-8.9.1",
  "linux-x86-8.9.2",
  "linux-x86-8.9.3",
  "linux-x86-8.9.4",
  "mac-x64-10.0.0",
  "mac-x64-10.1.0",
  "mac-x64-10.10.0",
  "mac-x64-10.11.0",
  "mac-x64-10.12.0",
  "mac-x64-10.13.0",
  "mac-x64-10.14.0",
  "mac-x64-10.14.1",
  "mac-x64-10.14.2",
  "mac-x64-10.15.0",
  "mac-x64-10.15.1",
  "mac-x64-10.15.2",
  "mac-x64-10.15.3",
  "mac-x64-10.16.0",
  "mac-x64-10.16.1",
  "mac-x64-10.16.2",
  "mac-x64-10.16.3",
  "mac-x64-10.17.0",
  "mac-x64-10.18.0",
  "mac-x64-10.18.1",
  "mac-x64-10.19.0",
  "mac-x64-10.2.0",
  "mac-x64-10.2.1",
  "mac-x64-10.20.0",
  "mac-x64-10.20.1",
  "mac-x64-10.21.0",
  "mac-x64-10.3.0",
  "mac-x64-10.4.0",
  "mac-x64-10.4.1",
  "mac-x64-10.5.0",
  "mac-x64-10.6.0",
  "mac-x64-10.7.0",
  "mac-x64-10.8.0",
  "mac-x64-10.9.0",
  "mac-x64-12.0.0",
  "mac-x64-12.1.0",
  "mac-x64-12.10.0",
  "mac-x64-12.11.1",
  "mac-x64-12.12.0",
  "mac-x64-12.13.0",
  "mac-x64-12.13.1",
  "mac-x64-12.14.0",
  "mac-x64-12.14.1",
  "mac-x64-12.15.0",
  "mac-x64-12.16.0",
  "mac-x64-12.16.1",
  "mac-x64-12.16.2",
  "mac-x64-12.16.3",
  "mac-x64-12.17.0",
  "mac-x64-12.18.0",
  "mac-x64-12.18.1",
  "mac-x64-12.18.2",
  "mac-x64-12.2.0",
  "mac-x64-12.3.0",
  "mac-x64-12.3.1",
  "mac-x64-12.4.0",
  "mac-x64-12.5.0",
  "mac-x64-12.6.0",
  "mac-x64-12.7.0",
  "mac-x64-12.8.0",
  "mac-x64-12.8.1",
  "mac-x64-12.9.0",
  "mac-x64-12.9.1",
  "mac-x64-14.0.0",
  "mac-x64-14.1.0",
  "mac-x64-14.12.0",
  "mac-x64-14.13.1",
  "mac-x64-14.14.0",
  "mac-x64-14.15.0",
  "mac-x64-14.15.1",
  "mac-x64-14.15.2",
  "mac-x64-14.15.3",
  "mac-x64-14.2.0",
  "mac-x64-14.3.0",
  "mac-x64-14.4.0",
  "mac-x64-14.5.0",
  "mac-x64-14.9.0",
  "mac-x64-4.8.4",
  "mac-x64-4.9.1",
  "mac-x64-6.0.0",
  "mac-x64-6.1.0",
  "mac-x64-6.10.0",
  "mac-x64-6.10.1",
  "mac-x64-6.10.2",
  "mac-x64-6.10.3",
  "mac-x64-6.11.0",
  "mac-x64-6.11.1",
  "mac-x64-6.11.2",
  "mac-x64-6.11.3",
  "mac-x64-6.11.4",
  "mac-x64-6.11.5",
  "mac-x64-6.12.0",
  "mac-x64-6.12.1",
  "mac-x64-6.12.2",
  "mac-x64-6.12.3",
  "mac-x64-6.13.0",
  "mac-x64-6.13.1",
  "mac-x64-6.14.0",
  "mac-x64-6.14.1",
  "mac-x64-6.14.2",
  "mac-x64-6.14.3",
  "mac-x64-6.14.4",
  "mac-x64-6.15.0",
  "mac-x64-6.15.1",
  "mac-x64-6.16.0",
  "mac-x64-6.17.0",
  "mac-x64-6.17.1",
  "mac-x64-6.2.0",
  "mac-x64-6.2.1",
  "mac-x64-6.2.2",
  "mac-x64-6.3.0",
  "mac-x64-6.3.1",
  "mac-x64-6.4.0",
  "mac-x64-6.5.0",
  "mac-x64-6.6.0",
  "mac-x64-6.7.0",
  "mac-x64-6.8.0",
  "mac-x64-6.8.1",
  "mac-x64-6.9.0",
  "mac-x64-6.9.1",
  "mac-x64-6.9.2",
  "mac-x64-6.9.3",
  "mac-x64-6.9.4",
  "mac-x64-6.9.5",
  "mac-x64-8.0.0",
  "mac-x64-8.1.0",
  "mac-x64-8.1.1",
  "mac-x64-8.1.2",
  "mac-x64-8.1.3",
  "mac-x64-8.1.4",
  "mac-x64-8.10.0",
  "mac-x64-8.11.0",
  "mac-x64-8.11.1",
  "mac-x64-8.11.2",
  "mac-x64-8.11.3",
  "mac-x64-8.11.4",
  "mac-x64-8.12.0",
  "mac-x64-8.13.0",
  "mac-x64-8.14.0",
  "mac-x64-8.14.1",
  "mac-x64-8.15.0",
  "mac-x64-8.15.1",
  "mac-x64-8.16.0",
  "mac-x64-8.16.1",
  "mac-x64-8.16.2",
  "mac-x64-8.17.0",
  "mac-x64-8.2.0",
  "mac-x64-8.2.1",
  "mac-x64-8.3.0",
  "mac-x64-8.4.0",
  "mac-x64-8.5.0",
  "mac-x64-8.6.0",
  "mac-x64-8.7.0",
  "mac-x64-8.8.0",
  "mac-x64-8.8.1",
  "mac-x64-8.9.0",
  "mac-x64-8.9.1",
  "mac-x64-8.9.2",
  "mac-x64-8.9.3",
  "mac-x64-8.9.4",
  "nexe-alpine-x86",
  "windows-x64-10.0.0",
  "windows-x64-10.1.0",
  "windows-x64-10.10.0",
  "windows-x64-10.11.0",
  "windows-x64-10.12.0",
  "windows-x64-10.13.0",
  "windows-x64-10.14.0",
  "windows-x64-10.14.1",
  "windows-x64-10.14.2",
  "windows-x64-10.15.0",
  "windows-x64-10.15.1",
  "windows-x64-10.15.2",
  "windows-x64-10.15.3",
  "windows-x64-10.16.0",
  "windows-x64-10.2.0",
  "windows-x64-10.2.1",
  "windows-x64-10.3.0",
  "windows-x64-10.4.0",
  "windows-x64-10.4.1",
  "windows-x64-10.5.0",
  "windows-x64-10.6.0",
  "windows-x64-10.7.0",
  "windows-x64-10.8.0",
  "windows-x64-10.9.0",
  "windows-x64-12.0.0",
  "windows-x64-12.1.0",
  "windows-x64-12.10.0",
  "windows-x64-12.11.1",
  "windows-x64-12.12.0",
  "windows-x64-12.13.0",
  "windows-x64-12.13.1",
  "windows-x64-12.14.0",
  "windows-x64-12.14.1",
  "windows-x64-12.15.0",
  "windows-x64-12.16.0",
  "windows-x64-12.16.1",
  "windows-x64-12.16.2",
  "windows-x64-12.16.3",
  "windows-x64-12.17.0",
  "windows-x64-12.18.0",
  "windows-x64-12.18.1",
  "windows-x64-12.18.2",
  "windows-x64-12.2.0",
  "windows-x64-12.3.0",
  "windows-x64-12.3.1",
  "windows-x64-12.4.0",
  "windows-x64-12.5.0",
  "windows-x64-12.6.0",
  "windows-x64-12.7.0",
  "windows-x64-12.8.0",
  "windows-x64-12.8.1",
  "windows-x64-12.9.0",
  "windows-x64-12.9.1",
  "windows-x64-14.0.0",
  "windows-x64-14.1.0",
  "windows-x64-14.15.1",
  "windows-x64-14.15.3",
  "windows-x64-14.2.0",
  "windows-x64-14.3.0",
  "windows-x64-14.4.0",
  "windows-x64-14.5.0",
  "windows-x64-4.8.4",
  "windows-x64-6.0.0",
  "windows-x64-6.1.0",
  "windows-x64-6.10.0",
  "windows-x64-6.10.1",
  "windows-x64-6.10.2",
  "windows-x64-6.10.3",
  "windows-x64-6.11.0",
  "windows-x64-6.11.1",
  "windows-x64-6.11.2",
  "windows-x64-6.11.3",
  "windows-x64-6.11.4",
  "windows-x64-6.11.5",
  "windows-x64-6.12.0",
  "windows-x64-6.12.1",
  "windows-x64-6.12.2",
  "windows-x64-6.12.3",
  "windows-x64-6.13.0",
  "windows-x64-6.13.1",
  "windows-x64-6.14.0",
  "windows-x64-6.14.1",
  "windows-x64-6.14.2",
  "windows-x64-6.14.3",
  "windows-x64-6.14.4",
  "windows-x64-6.15.0",
  "windows-x64-6.15.1",
  "windows-x64-6.16.0",
  "windows-x64-6.17.0",
  "windows-x64-6.17.1",
  "windows-x64-6.2.0",
  "windows-x64-6.2.1",
  "windows-x64-6.2.2",
  "windows-x64-6.3.0",
  "windows-x64-6.3.1",
  "windows-x64-6.4.0",
  "windows-x64-6.5.0",
  "windows-x64-6.6.0",
  "windows-x64-6.7.0",
  "windows-x64-6.8.0",
  "windows-x64-6.8.1",
  "windows-x64-6.9.0",
  "windows-x64-6.9.1",
  "windows-x64-6.9.2",
  "windows-x64-6.9.3",
  "windows-x64-6.9.4",
  "windows-x64-6.9.5",
  "windows-x64-8.0.0",
  "windows-x64-8.1.0",
  "windows-x64-8.1.1",
  "windows-x64-8.1.2",
  "windows-x64-8.1.3",
  "windows-x64-8.1.4",
  "windows-x64-8.10.0",
  "windows-x64-8.11.0",
  "windows-x64-8.11.1",
  "windows-x64-8.11.2",
  "windows-x64-8.11.3",
  "windows-x64-8.11.4",
  "windows-x64-8.12.0",
  "windows-x64-8.13.0",
  "windows-x64-8.14.0",
  "windows-x64-8.14.1",
  "windows-x64-8.15.0",
  "windows-x64-8.15.1",
  "windows-x64-8.16.0",
  "windows-x64-8.2.0",
  "windows-x64-8.2.1",
  "windows-x64-8.3.0",
  "windows-x64-8.4.0",
  "windows-x64-8.5.0",
  "windows-x64-8.6.0",
  "windows-x64-8.7.0",
  "windows-x64-8.8.0",
  "windows-x64-8.8.1",
  "windows-x64-8.9.0",
  "windows-x64-8.9.1",
  "windows-x64-8.9.2",
  "windows-x64-8.9.3",
  "windows-x64-8.9.4",
  "windows-x86-10.0.0",
  "windows-x86-10.1.0",
  "windows-x86-10.10.0",
  "windows-x86-10.11.0",
  "windows-x86-10.12.0",
  "windows-x86-10.13.0",
  "windows-x86-10.14.0",
  "windows-x86-10.14.1",
  "windows-x86-10.14.2",
  "windows-x86-10.15.0",
  "windows-x86-10.15.1",
  "windows-x86-10.15.2",
  "windows-x86-10.15.3",
  "windows-x86-10.16.0",
  "windows-x86-10.16.1",
  "windows-x86-10.16.2",
  "windows-x86-10.16.3",
  "windows-x86-10.2.0",
  "windows-x86-10.2.1",
  "windows-x86-10.3.0",
  "windows-x86-10.4.0",
  "windows-x86-10.4.1",
  "windows-x86-10.5.0",
  "windows-x86-10.6.0",
  "windows-x86-10.7.0",
  "windows-x86-10.8.0",
  "windows-x86-10.9.0",
  "windows-x86-12.0.0",
  "windows-x86-12.1.0",
  "windows-x86-12.10.0",
  "windows-x86-12.11.1",
  "windows-x86-12.12.0",
  "windows-x86-12.13.0",
  "windows-x86-12.13.1",
  "windows-x86-12.14.0",
  "windows-x86-12.14.1",
  "windows-x86-12.15.0",
  "windows-x86-12.16.0",
  "windows-x86-12.16.1",
  "windows-x86-12.16.2",
  "windows-x86-12.16.3",
  "windows-x86-12.17.0",
  "windows-x86-12.18.0",
  "windows-x86-12.18.1",
  "windows-x86-12.18.2",
  "windows-x86-12.2.0",
  "windows-x86-12.3.0",
  "windows-x86-12.3.1",
  "windows-x86-12.4.0",
  "windows-x86-12.5.0",
  "windows-x86-12.6.0",
  "windows-x86-12.7.0",
  "windows-x86-12.8.0",
  "windows-x86-12.8.1",
  "windows-x86-12.9.0",
  "windows-x86-12.9.1",
  "windows-x86-14.0.0",
  "windows-x86-14.1.0",
  "windows-x86-14.12.0",
  "windows-x86-14.15.1",
  "windows-x86-14.15.2",
  "windows-x86-14.15.3",
  "windows-x86-14.2.0",
  "windows-x86-14.3.0",
  "windows-x86-14.4.0",
  "windows-x86-14.5.0",
  "windows-x86-14.9.0",
  "windows-x86-4.8.4",
  "windows-x86-6.0.0",
  "windows-x86-6.1.0",
  "windows-x86-6.10.0",
  "windows-x86-6.10.1",
  "windows-x86-6.10.2",
  "windows-x86-6.10.3",
  "windows-x86-6.11.0",
  "windows-x86-6.11.1",
  "windows-x86-6.11.2",
  "windows-x86-6.11.3",
  "windows-x86-6.11.4",
  "windows-x86-6.11.5",
  "windows-x86-6.12.0",
  "windows-x86-6.12.1",
  "windows-x86-6.12.2",
  "windows-x86-6.12.3",
  "windows-x86-6.13.0",
  "windows-x86-6.13.1",
  "windows-x86-6.14.0",
  "windows-x86-6.14.1",
  "windows-x86-6.14.2",
  "windows-x86-6.14.3",
  "windows-x86-6.14.4",
  "windows-x86-6.15.0",
  "windows-x86-6.15.1",
  "windows-x86-6.16.0",
  "windows-x86-6.17.0",
  "windows-x86-6.17.1",
  "windows-x86-6.2.0",
  "windows-x86-6.2.1",
  "windows-x86-6.2.2",
  "windows-x86-6.3.0",
  "windows-x86-6.3.1",
  "windows-x86-6.4.0",
  "windows-x86-6.5.0",
  "windows-x86-6.6.0",
  "windows-x86-6.7.0",
  "windows-x86-6.8.0",
  "windows-x86-6.8.1",
  "windows-x86-6.9.0",
  "windows-x86-6.9.1",
  "windows-x86-6.9.2",
  "windows-x86-6.9.3",
  "windows-x86-6.9.4",
  "windows-x86-6.9.5",
  "windows-x86-8.0.0",
  "windows-x86-8.1.0",
  "windows-x86-8.1.1",
  "windows-x86-8.1.2",
  "windows-x86-8.1.3",
  "windows-x86-8.1.4",
  "windows-x86-8.10.0",
  "windows-x86-8.11.0",
  "windows-x86-8.11.1",
  "windows-x86-8.11.2",
  "windows-x86-8.11.3",
  "windows-x86-8.11.4",
  "windows-x86-8.12.0",
  "windows-x86-8.13.0",
  "windows-x86-8.14.0",
  "windows-x86-8.14.1",
  "windows-x86-8.15.0",
  "windows-x86-8.15.1",
  "windows-x86-8.16.0",
  "windows-x86-8.2.0",
  "windows-x86-8.2.1",
  "windows-x86-8.3.0",
  "windows-x86-8.4.0",
  "windows-x86-8.5.0",
  "windows-x86-8.6.0",
  "windows-x86-8.7.0",
  "windows-x86-8.8.0",
  "windows-x86-8.8.1",
  "windows-x86-8.9.0",
  "windows-x86-8.9.1",
  "windows-x86-8.9.2",
  "windows-x86-8.9.3",
  "windows-x86-8.9.4",
];

async function main(platform) {
  if (!platform) {
    console.error(
      chalk.red(
        `The first positional argument to this script must be a platform to build xode for. Valid platforms are: alpine-x64, alpine-x86, linux-x64, linux-x86, mac-x64, windows-x64, and windows-x86.`
      )
    );
  }

  console.log(chalk.blue(`Building xode for ${platform}...`));

  shelljs.rm("-rf", `build/${platform}`);
  shelljs.mkdir("-p", `build/${platform}`);

  const canUsePrebuiltVersion = prebuiltNodeVersions.includes(
    `${platform}-${nodeVersion}`
  );
  if (!canUsePrebuiltVersion) {
    console.error(
      chalk.yellow(
        `Warning: No prebuilt version of node ${nodeVersion} for ${platform} is available, so I'm compiling node from source instead. That will take a long time. You might want to check the list of available prebuilt versions in scripts/build.js and use one of those instead.`
      )
    );
  }

  run(
    `nexe ${
      canUsePrebuiltVersion ? "" : "--build"
    } -i xode/index.js -o ./build/${platform}/xode -t ${platform}-${nodeVersion}`
  );

  const nativeModules = await globby("node_modules/**/*.node");

  for (const filename of nativeModules) {
    console.log(
      chalk.magenta(
        `Copying native module '${filename}' to build/${platform}. Keep the node_modules folder next to ${
          platform.startsWith("windows") ? "xode.exe" : "xode"
        }.`
      )
    );
    shelljs.mkdir("-p", path.join(`build/${platform}`, path.dirname(filename)));
    shelljs.cp(filename, path.join(`build/${platform}`, filename));
  }
}

main(process.argv[2]).catch((err) => {
  console.error(err);
  process.exitCode = 1;
});
